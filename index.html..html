
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SwaMedia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      body { background-color: #000000; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #1f2937; } /* bg-gray-800 */
      ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; } /* bg-gray-600 */
      ::-webkit-scrollbar-thumb:hover { background: #6b7280; } /* bg-gray-500 */
      .page { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      
      /* Splash Screen Styles */
      #splash-screen { transition: opacity 0.5s ease-in-out; }
      @keyframes loading-bar-anim {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      .animate-loading-bar {
        animation: loading-bar-anim 1.5s infinite linear;
      }
    </style>
</head>
<body class="bg-black text-slate-200">
    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center">
        <div class="flex items-center space-x-3 animate-pulse">
            <svg class="w-12 h-12 text-red-500" viewBox="0 0 24 24" fill="currentColor"><path d="M6.5 10.5C5.67 10.5 5 11.17 5 12s.67 1.5 1.5 1.5S8 12.83 8 12 7.33 10.5 6.5 10.5zm11 0C16.67 10.5 16 11.17 16 12s.67 1.5 1.5 1.5S19 12.83 19 12s-.67-1.5-1.5-1.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-4c-1.48 0-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5s4.32-1.45 5.12-3.5h-1.67c-.7 1.19-1.97 2-3.45 2z"/></svg>
            <span class="text-4xl font-bold text-red-500">SwaMedia</span>
        </div>
        <div class="w-40 h-1 bg-gray-800 rounded-full mt-8 overflow-hidden">
            <div class="h-full bg-red-500 animate-loading-bar"></div>
        </div>
    </div>

    <main id="app-container" class="pb-24"></main>

    <nav class="fixed bottom-0 left-0 right-0 h-16 bg-black/80 backdrop-blur-lg z-50 border-t border-gray-800">
        <div class="flex justify-around items-center h-full max-w-lg mx-auto">
            <button data-page="home" class="nav-item flex flex-col items-center justify-center w-full text-red-500"><i class="fas fa-home text-xl"></i><span class="text-xs mt-1">Home</span></button>
            <button data-page="search" class="nav-item flex flex-col items-center justify-center w-full text-slate-400"><i class="fas fa-search text-xl"></i><span class="text-xs mt-1">Search</span></button>
            <button data-page="categories" class="nav-item flex flex-col items-center justify-center w-full text-slate-400"><i class="fas fa-th-large text-xl"></i><span class="text-xs mt-1">Categories</span></button>
            <button data-page="profile" class="nav-item flex flex-col items-center justify-center w-full text-slate-400"><i class="fas fa-user text-xl"></i><span class="text-xs mt-1">Profile</span></button>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
  apiKey: "AIzaSyAAWjWH55_WogACWc3vNVWrlLrwPYPfgmo",
  authDomain: "swamediaweb.firebaseapp.com",
  databaseURL: "https://swamediaweb-default-rtdb.firebaseio.com",
  projectId: "swamediaweb",
  storageBucket: "swamediaweb.firebasestorage.app",
  messagingSenderId: "70354150749",
  appId: "1:70354150749:web:046e78eb57ce1fe427f4b4"
};       
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        const appContainer = document.getElementById('app-container');
        let historyStack = ['home'];
        
        const SwaMediaLogo = `<div class="flex items-center space-x-2"><svg class="w-8 h-8 text-red-500" viewBox="0 0 24 24" fill="currentColor"><path d="M6.5 10.5C5.67 10.5 5 11.17 5 12s.67 1.5 1.5 1.5S8 12.83 8 12 7.33 10.5 6.5 10.5zm11 0C16.67 10.5 16 11.17 16 12s.67 1.5 1.5 1.5S19 12.83 19 12s-.67-1.5-1.5-1.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-4c-1.48 0-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5s4.32-1.45 5.12-3.5h-1.67c-.7 1.19-1.97 2-3.45 2z"/></svg><span class="text-2xl font-bold text-red-500">SwaMedia</span></div>`;

        // --- HELPERS ---
        const showLoader = (text = 'Loading...') => {
            appContainer.innerHTML = `<div class="flex flex-col items-center justify-center min-h-screen"><div class="w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full animate-spin"></div><p class="mt-4 text-slate-400">${text}</p></div>`;
        };
        const transformSnapshotToArray = (snapshot) => {
            const snapshotVal = snapshot.val();
            if (!snapshotVal) return [];
            return Object.keys(snapshotVal).map(key => {
                const value = snapshotVal[key];
                if (value && typeof value === 'object') {
                    return { id: key, ...value };
                }
                return { id: key, ...value}; // Also handle simple key:value like in featuredMovies
            }).filter(item => item !== null);
        };
        
        const fetchData = async (type) => {
            try {
                const snapshot = await get(ref(database, type));
                return snapshot;
            } catch (error) {
                console.error(`Error fetching ${type}:`, error);
                return { val: () => null }; // Return a mock snapshot on error
            }
        };


        // --- TEMPLATING ---
        const itemCardTemplate = (item, type) => {
            if (!item || !item.id || !item.title) return '';
            return `
            <div class="item-card flex-shrink-0 w-32 md:w-40 cursor-pointer group" data-id="${item.id}" data-type="${type}">
                <div class="relative transform hover:scale-105 transition-transform duration-300">
                    ${item.posterUrl ? `<img src="${item.posterUrl}" alt="${item.title}" class="w-full h-48 md:h-60 object-cover rounded-lg shadow-lg group-hover:shadow-red-600/40" loading="lazy">` : `<div class="w-full h-48 md:h-60 bg-gray-800 rounded-lg flex items-center justify-center"><i class="fas fa-film text-gray-600 text-3xl"></i></div>`}
                </div>
                <h3 class="text-sm font-semibold mt-2 truncate group-hover:text-red-400">${item.title}</h3>
                <p class="text-xs text-slate-400">${item.year || ''}</p>
            </div>`;
        };

        const carouselTemplate = (title, items, defaultType) => {
            if (!items || items.length === 0) return '';
            const typedItems = items.map(item => ({...item, type: item.type || defaultType }));
            return `
            <div class="my-6">
                <h2 class="text-xl font-bold mb-3 px-4">${title}</h2>
                <div class="flex overflow-x-auto space-x-4 px-4 pb-4 -mb-4">
                    ${typedItems.map(item => itemCardTemplate(item, item.type)).join('')}
                    <div class="flex-shrink-0 w-1"></div>
                </div>
            </div>`;
        };

        // --- PAGE RENDERING ---
        const renderHomePage = async () => {
            // Don't show the small loader on initial load, splash is showing
            const isInitialLoad = appContainer.innerHTML === '';
            if (!isInitialLoad) {
                showLoader();
            }

            const [bannersSnap, categoriesSnap, moviesSnap, seriesSnap, featuredMoviesSnap] = await Promise.all([
                fetchData('banners'), fetchData('categories'), fetchData('movies'), fetchData('series'), fetchData('featuredMovies')
            ]);
            
            const banners = transformSnapshotToArray(bannersSnap);
            const categories = transformSnapshotToArray(categoriesSnap);
            const movies = transformSnapshotToArray(moviesSnap);
            const series = transformSnapshotToArray(seriesSnap);
            
            const moviesWithTypes = (movies || []).map(m => ({ ...m, type: 'movie' }));
            const seriesWithTypes = (series || []).map(s => ({ ...s, type: 'series' }));

            const featuredIds = featuredMoviesSnap.exists() ? Object.keys(featuredMoviesSnap.val()) : [];
            const weeklyMovies = moviesWithTypes.filter(movie => featuredIds.includes(movie.id));

            const categoryCarousels = (categories || []).map(cat => {
                if (!cat || !cat.name) return '';
                const categoryContent = [...moviesWithTypes, ...seriesWithTypes].filter(item => item && item.category === cat.name);
                return carouselTemplate(cat.name, categoryContent, 'movie');
            }).join('');
            
            // Hide splash screen after data is fetched
            const splashScreen = document.getElementById('splash-screen');
            if(splashScreen && !splashScreen.classList.contains('opacity-0')) {
                splashScreen.classList.add('opacity-0');
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 500); // Must match CSS transition duration
            }

            appContainer.innerHTML = `
                <div class="page">
                    <header class="px-4 pt-6">${SwaMediaLogo}</header>
                    <div id="banner-carousel-container" class="mt-4 px-4"></div>
                    ${carouselTemplate('Movies of the Week', weeklyMovies, 'movie')}
                    ${carouselTemplate('Popular Movies', moviesWithTypes, 'movie')}
                    ${carouselTemplate('Popular Series', seriesWithTypes, 'series')}
                    ${categoryCarousels}
                </div>`;
            renderBannerCarousel(banners);
        };

        const renderBannerCarousel = (banners) => {
            const container = document.getElementById('banner-carousel-container');
            if (!container || !banners || banners.length === 0) {
                 if(container) container.remove();
                 return;
            }
            
            container.innerHTML = `
                <div id="banner-carousel" class="relative w-full h-48 md:h-64 overflow-hidden rounded-lg shadow-lg">
                    ${banners.map((banner, index) => (banner && banner.imageUrl) ? `<div class="banner-slide absolute inset-0 transition-opacity duration-1000 ease-in-out ${index === 0 ? 'opacity-100' : 'opacity-0'}"><img src="${banner.imageUrl}" class="w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div></div>` : '').join('')}
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">${banners.map((_, index) => `<button data-slide-to="${index}" class="banner-dot w-2 h-2 rounded-full ${index === 0 ? 'bg-red-500' : 'bg-slate-500'}"></button>`).join('')}</div>
                </div>`;

            let currentIndex = 0;
            const slides = container.querySelectorAll('.banner-slide');
            const dots = container.querySelectorAll('.banner-dot');
            if (slides.length <= 1) return;
            
            const intervalId = setInterval(() => {
                currentIndex = (currentIndex + 1) % slides.length;
                updateBanner(currentIndex, slides, dots);
            }, 5000);
            
            dots.forEach(dot => dot.addEventListener('click', () => {
                currentIndex = parseInt(dot.dataset.slideTo);
                updateBanner(currentIndex, slides, dots);
                clearInterval(intervalId);
            }));
        };
        
        const updateBanner = (index, slides, dots) => {
            slides.forEach((slide, i) => {
                slide.classList.toggle('opacity-100', i === index);
                slide.classList.toggle('opacity-0', i !== index);
            });
            dots.forEach((dot, i) => {
                dot.classList.toggle('bg-red-500', i === index);
                dot.classList.toggle('bg-slate-500', i !== index);
            });
        };
        
        const renderDetailsPage = async (itemId, itemType) => {
            if (!itemId || !itemType) { appContainer.innerHTML = 'Content ID or Type is missing.'; return; }
            showLoader();
            const dbPath = itemType === 'movie' ? 'movies' : 'series';
            const itemsSnap = await fetchData(dbPath);
            const items = transformSnapshotToArray(itemsSnap);
            const item = items.find(i => i && i.id === itemId);

            if (!item) { appContainer.innerHTML = `<div class="page text-center p-8"><p>Content unavailable. It might have been removed.</p><button id="back-btn" class="mt-4 bg-red-600 text-white font-bold py-2 px-4 rounded">Go Back</button></div>`; document.getElementById('back-btn')?.addEventListener('click', handleBack); return; }

            const header = `
                <div class="relative h-64 md:h-96">
                    ${item.posterUrl ? `<img src="${item.posterUrl}" class="w-full h-full object-cover opacity-30">` : ''}
                    <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent"></div>
                    <button id="back-btn" class="absolute top-4 left-4 bg-black/50 hover:bg-gray-800 text-white rounded-full w-10 h-10 flex items-center justify-center transition-colors z-10"><i class="fas fa-arrow-left"></i></button>
                    <div class="absolute bottom-0 left-0 right-0 p-4 flex items-end space-x-4">
                        ${item.posterUrl ? `<img src="${item.posterUrl}" class="w-28 md:w-36 h-auto object-cover rounded-lg shadow-2xl flex-shrink-0">` : ''}
                        <div class="flex-grow"><h1 class="text-2xl md:text-4xl font-bold">${item.title || ''}</h1><p class="text-slate-400">${item.year || ''}</p></div>
                    </div>
                </div>`;
            
            const metaInfo = `
                <div class="p-4 space-y-6">
                    <div class="flex items-center space-x-4 text-slate-400 flex-wrap gap-2">
                        ${item.rating ? `<div class="flex items-center space-x-1"><i class="fas fa-star text-yellow-400"></i><span class="font-bold text-lg text-white">${item.rating}</span><span>/ 10</span></div><span class="text-slate-600 hidden md:inline">•</span>` : ''}
                        ${item.category ? `<span class="border border-slate-600 rounded px-2 py-0.5 text-sm">${item.category}</span>` : ''}
                    </div>
                    <div><h2 class="text-lg font-semibold mb-2">Description</h2><p class="text-slate-300 leading-relaxed">${item.description || 'No description available.'}</p></div>
                    <div><h2 class="text-lg font-semibold mb-2">Cast</h2><p class="text-slate-400">${item.cast || 'N/A'}</p></div>
                </div>`;
            
            let contentBody = '';
            if (itemType === 'movie') {
                const parts = item.parts && typeof item.parts === 'object' ? Object.values(item.parts) : [];
                if (parts.length > 0) {
                    contentBody = `<div class="p-4 space-y-3">${parts.map((part, i) => part ? `
                        <div class="bg-gray-900 p-3 rounded-lg"><h3 class="font-semibold mb-2">${part.title || `Part ${i+1}`}</h3>
                            <div class="flex space-x-2">${part.watchUrl ? `<a href="${part.watchUrl}" target="_blank" class="flex-1 text-center bg-red-600 hover:bg-red-700 py-2 rounded-lg"><i class="fas fa-play mr-2"></i>Watch</a>` : ''}${part.downloadUrl ? `<a href="${part.downloadUrl}" target="_blank" class="flex-1 text-center bg-gray-600 hover:bg-gray-500 py-2 rounded-lg"><i class="fas fa-download mr-2"></i>Download</a>` : ''}</div>
                        </div>` : '').join('')}</div>`;
                } else {
                    contentBody = `<div class="p-4 flex space-x-3">${item.watchUrl ? `<a href="${item.watchUrl}" target="_blank" class="flex-1 text-center bg-red-600 hover:bg-red-700 py-3 rounded-lg font-bold"><i class="fas fa-play mr-2"></i>Watch Now</a>` : ''}${item.downloadUrl ? `<a href="${item.downloadUrl}" target="_blank" class="flex-1 text-center bg-gray-600 hover:bg-gray-500 py-3 rounded-lg font-bold"><i class="fas fa-download mr-2"></i>Download</a>` : ''}</div>`;
                }
            } else if (itemType === 'series') {
                const seasons = item.seasons && typeof item.seasons === 'object' ? Object.values(item.seasons).sort((a,b) => (a.number || 0) - (b.number || 0)) : [];
                contentBody = `
                    <div class="p-4 space-y-4">
                        <div class="relative"><input id="episode-search" type="text" placeholder="Search episodes by number or title..." class="w-full bg-gray-900 border border-gray-700 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-1 focus:ring-red-500"><i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i></div>
                        <div id="seasons-container" class="space-y-4">
                        ${seasons.length > 0 ? seasons.map((season, i) => {
                            if (!season) return '';
                            const episodes = season.episodes && typeof season.episodes === 'object' ? Object.values(season.episodes).sort((a,b) => (a.number || 0) - (b.number || 0)) : [];
                            return `
                            <div class="season-block"><h3 class="text-xl font-bold mb-2">Season ${season.number || i + 1}</h3>
                                <div class="episodes-list space-y-2">
                                ${episodes.length > 0 ? episodes.map(ep => ep ? `
                                    <div class="episode-item bg-gray-900 p-3 rounded-lg" data-title="e${ep.number} ${ep.title || ''}">
                                        <p class="font-semibold">E${ep.number} - ${ep.title || 'Untitled Episode'}</p>
                                        <div class="flex space-x-2 mt-2">${ep.watchUrl ? `<a href="${ep.watchUrl}" target="_blank" class="flex-1 text-center bg-red-600/80 hover:bg-red-600 text-sm py-1.5 rounded-md">Watch</a>` : ''}${ep.downloadUrl ? `<a href="${ep.downloadUrl}" target="_blank" class="flex-1 text-center bg-gray-600/80 hover:bg-gray-600 text-sm py-1.5 rounded-md">Download</a>` : ''}</div>
                                    </div>` : '').join('') : '<p class="text-slate-400 px-3">No episodes available for this season.</p>'}
                                </div>
                            </div>`;
                        }).join('') : '<p class="text-slate-400">No seasons available for this series.</p>'}
                        </div>
                    </div>`;
            }

            appContainer.innerHTML = `<div class="page">${header}${metaInfo}${contentBody}</div>`;
            document.getElementById('back-btn')?.addEventListener('click', handleBack);
            document.getElementById('episode-search')?.addEventListener('input', handleEpisodeSearch);
        };

        const handleEpisodeSearch = (e) => {
            con
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SwaMedia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      body { background-color: #000000; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #1f2937; } /* bg-gray-800 */
      ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; } /* bg-gray-600 */
      ::-webkit-scrollbar-thumb:hover { background: #6b7280; } /* bg-gray-500 */
      .page { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      
      /* Splash Screen Styles */
      #splash-screen { transition: opacity 0.5s ease-in-out; }
      @keyframes loading-bar-anim {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      .animate-loading-bar {
        animation: loading-bar-anim 1.5s infinite linear;
      }
    </style>
</head>
<body class="bg-black text-slate-200">
    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center">
        <div class="flex items-center space-x-3 animate-pulse">
            <svg class="w-12 h-12 text-red-500" viewBox="0 0 24 24" fill="currentColor"><path d="M6.5 10.5C5.67 10.5 5 11.17 5 12s.67 1.5 1.5 1.5S8 12.83 8 12 7.33 10.5 6.5 10.5zm11 0C16.67 10.5 16 11.17 16 12s.67 1.5 1.5 1.5S19 12.83 19 12s-.67-1.5-1.5-1.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-4c-1.48 0-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5s4.32-1.45 5.12-3.5h-1.67c-.7 1.19-1.97 2-3.45 2z"/></svg>
            <span class="text-4xl font-bold text-red-500">SwaMedia</span>
        </div>
        <div class="w-40 h-1 bg-gray-800 rounded-full mt-8 overflow-hidden">
            <div class="h-full bg-red-500 animate-loading-bar"></div>
        </div>
    </div>

    <main id="app-container" class="pb-24"></main>

    <nav class="fixed bottom-0 left-0 right-0 h-16 bg-black/80 backdrop-blur-lg z-50 border-t border-gray-800">
        <div class="flex justify-around items-center h-full max-w-lg mx-auto">
            <button data-page="home" class="nav-item flex flex-col items-center justify-center w-full text-red-500"><i class="fas fa-home text-xl"></i><span class="text-xs mt-1">Home</span></button>
            <button data-page="search" class="nav-item flex flex-col items-center justify-center w-full text-slate-400"><i class="fas fa-search text-xl"></i><span class="text-xs mt-1">Search</span></button>
            <button data-page="categories" class="nav-item flex flex-col items-center justify-center w-full text-slate-400"><i class="fas fa-th-large text-xl"></i><span class="text-xs mt-1">Categories</span></button>
            <button data-page="profile" class="nav-item flex flex-col items-center justify-center w-full text-slate-400"><i class="fas fa-user text-xl"></i><span class="text-xs mt-1">Profile</span></button>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
  apiKey: "AIzaSyAAWjWH55_WogACWc3vNVWrlLrwPYPfgmo",
  authDomain: "swamediaweb.firebaseapp.com",
  databaseURL: "https://swamediaweb-default-rtdb.firebaseio.com",
  projectId: "swamediaweb",
  storageBucket: "swamediaweb.firebasestorage.app",
  messagingSenderId: "70354150749",
  appId: "1:70354150749:web:046e78eb57ce1fe427f4b4"
};       

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        const appContainer = document.getElementById('app-container');
        let historyStack = ['home'];
        
        const SwaMediaLogo = `<div class="flex items-center space-x-2"><svg class="w-8 h-8 text-red-500" viewBox="0 0 24 24" fill="currentColor"><path d="M6.5 10.5C5.67 10.5 5 11.17 5 12s.67 1.5 1.5 1.5S8 12.83 8 12 7.33 10.5 6.5 10.5zm11 0C16.67 10.5 16 11.17 16 12s.67 1.5 1.5 1.5S19 12.83 19 12s-.67-1.5-1.5-1.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-4c-1.48 0-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5s4.32-1.45 5.12-3.5h-1.67c-.7 1.19-1.97 2-3.45 2z"/></svg><span class="text-2xl font-bold text-red-500">SwaMedia</span></div>`;

        // --- HELPERS ---
        const showLoader = (text = 'Loading...') => {
            appContainer.innerHTML = `<div class="flex flex-col items-center justify-center min-h-screen"><div class="w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full animate-spin"></div><p class="mt-4 text-slate-400">${text}</p></div>`;
        };
        const transformSnapshotToArray = (snapshot) => {
            const snapshotVal = snapshot.val();
            if (!snapshotVal) return [];
            return Object.keys(snapshotVal).map(key => {
                const value = snapshotVal[key];
                if (value && typeof value === 'object') {
                    return { id: key, ...value };
                }
                return { id: key, ...value}; // Also handle simple key:value like in featuredMovies
            }).filter(item => item !== null);
        };
        
        const fetchData = async (type) => {
            try {
                const snapshot = await get(ref(database, type));
                return snapshot;
            } catch (error) {
                console.error(`Error fetching ${type}:`, error);
                return { val: () => null }; // Return a mock snapshot on error
            }
        };


        // --- TEMPLATING ---
        const itemCardTemplate = (item, type) => {
            if (!item || !item.id || !item.title) return '';
            return `
            <div class="item-card flex-shrink-0 w-32 md:w-40 cursor-pointer group" data-id="${item.id}" data-type="${type}">
                <div class="relative transform hover:scale-105 transition-transform duration-300">
                    ${item.posterUrl ? `<img src="${item.posterUrl}" alt="${item.title}" class="w-full h-48 md:h-60 object-cover rounded-lg shadow-lg group-hover:shadow-red-600/40" loading="lazy">` : `<div class="w-full h-48 md:h-60 bg-gray-800 rounded-lg flex items-center justify-center"><i class="fas fa-film text-gray-600 text-3xl"></i></div>`}
                </div>
                <h3 class="text-sm font-semibold mt-2 truncate group-hover:text-red-400">${item.title}</h3>
                <p class="text-xs text-slate-400">${item.year || ''}</p>
            </div>`;
        };

        const carouselTemplate = (title, items, defaultType) => {
            if (!items || items.length === 0) return '';
            const typedItems = items.map(item => ({...item, type: item.type || defaultType }));
            return `
            <div class="my-6">
                <h2 class="text-xl font-bold mb-3 px-4">${title}</h2>
                <div class="flex overflow-x-auto space-x-4 px-4 pb-4 -mb-4">
                    ${typedItems.map(item => itemCardTemplate(item, item.type)).join('')}
                    <div class="flex-shrink-0 w-1"></div>
                </div>
            </div>`;
        };

        // --- PAGE RENDERING ---
        const renderHomePage = async () => {
            // Don't show the small loader on initial load, splash is showing
            const isInitialLoad = appContainer.innerHTML === '';
            if (!isInitialLoad) {
                showLoader();
            }

            const [bannersSnap, categoriesSnap, moviesSnap, seriesSnap, featuredMoviesSnap] = await Promise.all([
                fetchData('banners'), fetchData('categories'), fetchData('movies'), fetchData('series'), fetchData('featuredMovies')
            ]);
            
            const banners = transformSnapshotToArray(bannersSnap);
            const categories = transformSnapshotToArray(categoriesSnap);
            const movies = transformSnapshotToArray(moviesSnap);
            const series = transformSnapshotToArray(seriesSnap);
            
            const moviesWithTypes = (movies || []).map(m => ({ ...m, type: 'movie' }));
            const seriesWithTypes = (series || []).map(s => ({ ...s, type: 'series' }));

            const featuredIds = featuredMoviesSnap.exists() ? Object.keys(featuredMoviesSnap.val()) : [];
            const weeklyMovies = moviesWithTypes.filter(movie => featuredIds.includes(movie.id));

            const categoryCarousels = (categories || []).map(cat => {
                if (!cat || !cat.name) return '';
                const categoryContent = [...moviesWithTypes, ...seriesWithTypes].filter(item => item && item.category === cat.name);
                return carouselTemplate(cat.name, categoryContent, 'movie');
            }).join('');
            
            // Hide splash screen after data is fetched
            const splashScreen = document.getElementById('splash-screen');
            if(splashScreen && !splashScreen.classList.contains('opacity-0')) {
                splashScreen.classList.add('opacity-0');
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 500); // Must match CSS transition duration
            }

            appContainer.innerHTML = `
                <div class="page">
                    <header class="px-4 pt-6">${SwaMediaLogo}</header>
                    <div id="banner-carousel-container" class="mt-4 px-4"></div>
                    ${carouselTemplate('Movies of the Week', weeklyMovies, 'movie')}
                    ${carouselTemplate('Popular Movies', moviesWithTypes, 'movie')}
                    ${carouselTemplate('Popular Series', seriesWithTypes, 'series')}
                    ${categoryCarousels}
                </div>`;
            renderBannerCarousel(banners);
        };

        const renderBannerCarousel = (banners) => {
            const container = document.getElementById('banner-carousel-container');
            if (!container || !banners || banners.length === 0) {
                 if(container) container.remove();
                 return;
            }
            
            container.innerHTML = `
                <div id="banner-carousel" class="relative w-full h-48 md:h-64 overflow-hidden rounded-lg shadow-lg">
                    ${banners.map((banner, index) => (banner && banner.imageUrl) ? `<div class="banner-slide absolute inset-0 transition-opacity duration-1000 ease-in-out ${index === 0 ? 'opacity-100' : 'opacity-0'}"><img src="${banner.imageUrl}" class="w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div></div>` : '').join('')}
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">${banners.map((_, index) => `<button data-slide-to="${index}" class="banner-dot w-2 h-2 rounded-full ${index === 0 ? 'bg-red-500' : 'bg-slate-500'}"></button>`).join('')}</div>
                </div>`;

            let currentIndex = 0;
            const slides = container.querySelectorAll('.banner-slide');
            const dots = container.querySelectorAll('.banner-dot');
            if (slides.length <= 1) return;
            
            const intervalId = setInterval(() => {
                currentIndex = (currentIndex + 1) % slides.length;
                updateBanner(currentIndex, slides, dots);
            }, 5000);
            
            dots.forEach(dot => dot.addEventListener('click', () => {
                currentIndex = parseInt(dot.dataset.slideTo);
                updateBanner(currentIndex, slides, dots);
                clearInterval(intervalId);
            }));
        };
        
        const updateBanner = (index, slides, dots) => {
            slides.forEach((slide, i) => {
                slide.classList.toggle('opacity-100', i === index);
                slide.classList.toggle('opacity-0', i !== index);
            });
            dots.forEach((dot, i) => {
                dot.classList.toggle('bg-red-500', i === index);
                dot.classList.toggle('bg-slate-500', i !== index);
            });
        };
        
        const renderDetailsPage = async (itemId, itemType) => {
            if (!itemId || !itemType) { appContainer.innerHTML = 'Content ID or Type is missing.'; return; }
            showLoader();
            const dbPath = itemType === 'movie' ? 'movies' : 'series';
            const itemsSnap = await fetchData(dbPath);
            const items = transformSnapshotToArray(itemsSnap);
            const item = items.find(i => i && i.id === itemId);

            if (!item) { appContainer.innerHTML = `<div class="page text-center p-8"><p>Content unavailable. It might have been removed.</p><button id="back-btn" class="mt-4 bg-red-600 text-white font-bold py-2 px-4 rounded">Go Back</button></div>`; document.getElementById('back-btn')?.addEventListener('click', handleBack); return; }

            const header = `
                <div class="relative h-64 md:h-96">
                    ${item.posterUrl ? `<img src="${item.posterUrl}" class="w-full h-full object-cover opacity-30">` : ''}
                    <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent"></div>
                    <button id="back-btn" class="absolute top-4 left-4 bg-black/50 hover:bg-gray-800 text-white rounded-full w-10 h-10 flex items-center justify-center transition-colors z-10"><i class="fas fa-arrow-left"></i></button>
                    <div class="absolute bottom-0 left-0 right-0 p-4 flex items-end space-x-4">
                        ${item.posterUrl ? `<img src="${item.posterUrl}" class="w-28 md:w-36 h-auto object-cover rounded-lg shadow-2xl flex-shrink-0">` : ''}
                        <div class="flex-grow"><h1 class="text-2xl md:text-4xl font-bold">${item.title || ''}</h1><p class="text-slate-400">${item.year || ''}</p></div>
                    </div>
                </div>`;
            
            const metaInfo = `
                <div class="p-4 space-y-6">
                    <div class="flex items-center space-x-4 text-slate-400 flex-wrap gap-2">
                        ${item.rating ? `<div class="flex items-center space-x-1"><i class="fas fa-star text-yellow-400"></i><span class="font-bold text-lg text-white">${item.rating}</span><span>/ 10</span></div><span class="text-slate-600 hidden md:inline">•</span>` : ''}
                        ${item.category ? `<span class="border border-slate-600 rounded px-2 py-0.5 text-sm">${item.category}</span>` : ''}
                    </div>
                    <div><h2 class="text-lg font-semibold mb-2">Description</h2><p class="text-slate-300 leading-relaxed">${item.description || 'No description available.'}</p></div>
                    <div><h2 class="text-lg font-semibold mb-2">Cast</h2><p class="text-slate-400">${item.cast || 'N/A'}</p></div>
                </div>`;
            
            let contentBody = '';
            if (itemType === 'movie') {
                const parts = item.parts && typeof item.parts === 'object' ? Object.values(item.parts) : [];
                if (parts.length > 0) {
                    contentBody = `<div class="p-4 space-y-3">${parts.map((part, i) => part ? `
                        <div class="bg-gray-900 p-3 rounded-lg"><h3 class="font-semibold mb-2">${part.title || `Part ${i+1}`}</h3>
                            <div class="flex space-x-2">${part.watchUrl ? `<a href="${part.watchUrl}" target="_blank" class="flex-1 text-center bg-red-600 hover:bg-red-700 py-2 rounded-lg"><i class="fas fa-play mr-2"></i>Watch</a>` : ''}${part.downloadUrl ? `<a href="${part.downloadUrl}" target="_blank" class="flex-1 text-center bg-gray-600 hover:bg-gray-500 py-2 rounded-lg"><i class="fas fa-download mr-2"></i>Download</a>` : ''}</div>
                        </div>` : '').join('')}</div>`;
                } else {
                    contentBody = `<div class="p-4 flex space-x-3">${item.watchUrl ? `<a href="${item.watchUrl}" target="_blank" class="flex-1 text-center bg-red-600 hover:bg-red-700 py-3 rounded-lg font-bold"><i class="fas fa-play mr-2"></i>Watch Now</a>` : ''}${item.downloadUrl ? `<a href="${item.downloadUrl}" target="_blank" class="flex-1 text-center bg-gray-600 hover:bg-gray-500 py-3 rounded-lg font-bold"><i class="fas fa-download mr-2"></i>Download</a>` : ''}</div>`;
                }
            } else if (itemType === 'series') {
                const seasons = item.seasons && typeof item.seasons === 'object' ? Object.values(item.seasons).sort((a,b) => (a.number || 0) - (b.number || 0)) : [];
                contentBody = `
                    <div class="p-4 space-y-4">
                        <div class="relative"><input id="episode-search" type="text" placeholder="Search episodes by number or title..." class="w-full bg-gray-900 border border-gray-700 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-1 focus:ring-red-500"><i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i></div>
                        <div id="seasons-container" class="space-y-4">
                        ${seasons.length > 0 ? seasons.map((season, i) => {
                            if (!season) return '';
                            const episodes = season.episodes && typeof season.episodes === 'object' ? Object.values(season.episodes).sort((a,b) => (a.number || 0) - (b.number || 0)) : [];
                            return `
                            <div class="season-block"><h3 class="text-xl font-bold mb-2">Season ${season.number || i + 1}</h3>
                                <div class="episodes-list space-y-2">
                                ${episodes.length > 0 ? episodes.map(ep => ep ? `
                                    <div class="episode-item bg-gray-900 p-3 rounded-lg" data-title="e${ep.number} ${ep.title || ''}">
                                        <p class="font-semibold">E${ep.number} - ${ep.title || 'Untitled Episode'}</p>
                                        <div class="flex space-x-2 mt-2">${ep.watchUrl ? `<a href="${ep.watchUrl}" target="_blank" class="flex-1 text-center bg-red-600/80 hover:bg-red-600 text-sm py-1.5 rounded-md">Watch</a>` : ''}${ep.downloadUrl ? `<a href="${ep.downloadUrl}" target="_blank" class="flex-1 text-center bg-gray-600/80 hover:bg-gray-600 text-sm py-1.5 rounded-md">Download</a>` : ''}</div>
                                    </div>` : '').join('') : '<p class="text-slate-400 px-3">No episodes available for this season.</p>'}
                                </div>
                            </div>`;
                        }).join('') : '<p class="text-slate-400">No seasons available for this series.</p>'}
                        </div>
                    </div>`;
            }

            appContainer.innerHTML = `<div class="page">${header}${metaInfo}${contentBody}</div>`;
            document.getElementById('back-btn')?.addEventListener('click', handleBack);
            document.getElementById('episode-search')?.addEventListener('input', handleEpisodeSearch);
        };

        const handleEpisodeSearch = (e) => {
   